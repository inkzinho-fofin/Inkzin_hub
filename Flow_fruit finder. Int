-- [[ 1: CONFIGURAÇÕES E GETGENV ]]
-- Você pode mudar esses valores antes de executar ou via console após executado.
getgenv().FlowInterface = {
    BackgroundID = "", -- ID da imagem de fundo
    IconID = "rbxassetid://135908570815238",       -- ID do botão e ícones de log
    CoreURL = loadstring(game:HttpGet("https://raw.githubusercontent.com/inkzinho-fofin/Inkzin_hub/refs/heads/main/Flow_fruit_core"))()
}

-- [[ 2: CRIAÇÃO DA INTERFACE VISUAL ]]
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local lp = Players.LocalPlayer

-- Limpeza de UI antiga
if CoreGui:FindFirstChild("FlowSystemUI") then CoreGui.FlowSystemUI:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FlowSystemUI"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false

-- Botão Redondo (Superior Esquerdo)
local ToggleBtn = Instance.new("ImageButton")
ToggleBtn.Name = "ToggleButton"
ToggleBtn.Parent = ScreenGui
ToggleBtn.Position = UDim2.new(0, 15, 0, 15)
ToggleBtn.Size = UDim2.new(0, 55, 0, 55)
ToggleBtn.Image = getgenv().FlowInterface.IconID
ToggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)

local BtnCorner = Instance.new("UICorner")
BtnCorner.CornerRadius = UDim.new(1, 0)
BtnCorner.Parent = ToggleBtn

-- Painel Central
local MainFrame = Instance.new("ImageLabel")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.Size = UDim2.new(0, 420, 0, 260)
MainFrame.Image = getgenv().FlowInterface.BackgroundID
MainFrame.Visible = false
MainFrame.ClipsDescendants = true

local FrameCorner = Instance.new("UICorner")
FrameCorner.CornerRadius = UDim.new(0, 12)
FrameCorner.Parent = MainFrame

local Stroke = Instance.new("UIStroke")
Stroke.Thickness = 2
Stroke.Color = Color3.new(1, 1, 1)
Stroke.Parent = MainFrame

-- Scrolling Frame para Logs
local LogScroll = Instance.new("ScrollingFrame")
LogScroll.Parent = MainFrame
LogScroll.Size = UDim2.new(0.9, 0, 0.8, 0)
LogScroll.Position = UDim2.new(0.05, 0, 0.12, 0)
LogScroll.BackgroundTransparency = 1
LogScroll.ScrollBarThickness = 2
LogScroll.CanvasSize = UDim2.new(0, 0, 0, 0)

local LogLayout = Instance.new("UIListLayout")
LogLayout.Parent = LogScroll
LogLayout.Padding = UDim.new(0, 5)

-- [[ 3: SISTEMA DE LOGS COM ÍCONE ]]
local function AddLog(msg)
    local Entry = Instance.new("Frame")
    Entry.Size = UDim2.new(1, 0, 0, 25)
    Entry.BackgroundTransparency = 1
    Entry.Parent = LogScroll

    local Icon = Instance.new("ImageLabel")
    Icon.Size = UDim2.new(0, 20, 0, 20)
    Icon.Image = getgenv().FlowInterface.IconID
    Icon.BackgroundTransparency = 1
    Icon.Parent = Entry

    local Text = Instance.new("TextLabel")
    Text.Size = UDim2.new(1, -25, 1, 0)
    Text.Position = UDim2.new(0, 25, 0, 0)
    Text.Text = msg
    Text.TextColor3 = Color3.new(1, 1, 1)
    Text.Font = Enum.Font.Gotham
    Text.TextSize = 13
    Text.TextXAlignment = Enum.TextXAlignment.Left
    Text.BackgroundTransparency = 1
    Text.Parent = Entry

    LogScroll.CanvasSize = UDim2.new(0, 0, 0, LogLayout.AbsoluteContentSize.Y)
    LogScroll.CanvasPosition = Vector2.new(0, LogScroll.CanvasSize.Y.Offset)
end

-- [[ 4: LÓGICA DE EXECUÇÃO (LOADSTRING) ]]
local function ExecuteCore()
    AddLog("Executando e esperando entrada no servidor...")
    
    local success, content = pcall(game.HttpGet, game, getgenv().FlowInterface.CoreURL)
    
    if success then
        local func, err = loadstring(content)
        if func then
            task.spawn(func)
            AddLog("Core Script carregado com sucesso!")
        else
            AddLog("Erro no loadstring: " .. tostring(err))
        end
    else
        AddLog("Erro ao baixar o script do GitHub.")
    end
end

-- [[ 5: MONITORAMENTO E INTERAÇÃO ]]
ToggleBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

-- Loop para observar o status e atualizar imagem via getgenv
task.spawn(function()
    local lastTeam = ""
    ExecuteCore()

    while task.wait(1) do
        -- Atualiza imagem de fundo dinamicamente se mudar o getgenv
        if MainFrame.Image ~= getgenv().FlowInterface.BackgroundID then
            MainFrame.Image = getgenv().FlowInterface.BackgroundID
        end

        -- Monitorar Entrada no Time Marine
        if lp.Team and lp.Team.Name == "Marines" and lastTeam ~= "Marines" then
            AddLog("Time selecionado: Marine (Marinheiro)")
            lastTeam = "Marines"
        end

        -- Monitorar Frutas (Exemplo de leitura constante)
        for _, v in pairs(workspace:GetChildren()) do
            if v:IsA("Tool") and (v.Name:find("Fruit") or v.Name:find("Fruta")) then
                AddLog("Fruta detectada: " .. v.Name)
                AddLog("Armazenando fruta encontrada...")
                task.wait(2) -- Delay para evitar spam no log
            end
        end
    end
end)
