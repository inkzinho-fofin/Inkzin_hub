-- [[ INTERFACE FLOW FRUIT FINDER ]]

-- 1. Verificação de Configurações (Getgenv)
local config = getgenv().FlowInterface or {}
local bgID = config.BackgroundID or "135908570815238"
local iconID = config.IconID or "rbxassetid://135908570815238"
local coreURL = config.CoreURL or loadstring(game:HttpGet("https://raw.githubusercontent.com/inkzinho-fofin/Inkzin_hub/refs/heads/main/Flow_fruit_core"))()

-- Função para garantir formato de imagem
local function getImg(id)
    id = tostring(id)
    return id:find("rbxassetid://") and id or "rbxassetid://" .. id
end

-- 2. Criação da UI
local CoreGui = game:GetService("CoreGui")
local lp = game.Players.LocalPlayer

if CoreGui:FindFirstChild("FlowUI") then CoreGui.FlowUI:Destroy() end

local sg = Instance.new("ScreenGui", CoreGui)
sg.Name = "FlowUI"

-- Botão de Toggle (Redondo)
local btn = Instance.new("ImageButton", sg)
btn.Size = UDim2.new(0, 55, 0, 55)
btn.Position = UDim2.new(0, 15, 0, 15)
btn.Image = getImg(iconID)
btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
btn.BorderSizePixel = 0
Instance.new("UICorner", btn).CornerRadius = UDim.new(1, 0)

-- Painel Principal
local frame = Instance.new("ImageLabel", sg)
frame.Size = UDim2.new(0, 420, 0, 260)
frame.Position = UDim2.new(0.5, -210, 0.5, -130)
frame.Image = getImg(bgID)
frame.Visible = false
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)
Instance.new("UIStroke", frame).Thickness = 2

-- Área de Logs
local scroll = Instance.new("ScrollingFrame", frame)
scroll.Size = UDim2.new(0.9, 0, 0.8, 0)
scroll.Position = UDim2.new(0.05, 0, 0.12, 0)
scroll.BackgroundTransparency = 1
scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
scroll.ScrollBarThickness = 2

local layout = Instance.new("UIListLayout", scroll)
layout.Padding = UDim.new(0, 5)

-- 3. Função de Logs com Ícone
local lastLog = ""
local function addLog(msg)
    if msg == lastLog then return end
    lastLog = msg
    
    local entry = Instance.new("Frame", scroll)
    entry.Size = UDim2.new(1, 0, 0, 25)
    entry.BackgroundTransparency = 1

    local img = Instance.new("ImageLabel", entry)
    img.Size = UDim2.new(0, 20, 0, 20)
    img.Image = getImg(iconID)
    img.BackgroundTransparency = 1

    local txt = Instance.new("TextLabel", entry)
    txt.Size = UDim2.new(1, -25, 1, 0)
    txt.Position = UDim2.new(0, 25, 0, 0)
    txt.Text = msg
    txt.TextColor3 = Color3.new(1, 1, 1)
    txt.Font = Enum.Font.GothamSemibold
    txt.TextSize = 13
    txt.BackgroundTransparency = 1
    txt.TextXAlignment = "Left"

    scroll.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y)
    scroll.CanvasPosition = Vector2.new(0, scroll.CanvasSize.Y.Offset)
end

-- 4. Botão de abrir/fechar
btn.MouseButton1Click:Connect(function()
    frame.Visible = not frame.Visible
end)

-- 5. Chamada do Script Core (O Script da Interface chama o Core)
task.spawn(function()
    addLog("Buscando script core...")
    local success, content = pcall(game.HttpGet, game, coreURL)
    if success then
        addLog("Core carregado! Executando...")
        local func = loadstring(content)
        if func then task.spawn(func) end
    else
        addLog("Erro ao carregar o Core.")
    end
end)

-- 6. Monitoramento em tempo real
task.spawn(function()
    local lastTeam = ""
    while task.wait(0.5) do
        -- Sincronizar Fundo (Getgenv dinâmico)
        local currentBG = getgenv().FlowInterface and getgenv().FlowInterface.BackgroundID or bgID
        if frame.Image ~= getImg(currentBG) then
            frame.Image = getImg(currentBG)
        end

        -- Monitorar Marinheiros
        if lp.Team and lp.Team.Name == "Marines" and lastTeam ~= "Marines" then
            addLog("Time Marine selecionado.")
            lastTeam = "Marines"
        end

        -- Monitorar Frutas
        for _, v in pairs(workspace:GetChildren()) do
            if v:IsA("Tool") and (v.Name:find("Fruit") or v.Name:find("Fruta")) then
                addLog("Fruta detectada: " .. v.Name)
                addLog("Aguardando armazenamento...")
                task.wait(2)
            end
        end
    end
end)
