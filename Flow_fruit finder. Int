--[[
    FLOW FRUIT FINDER - INTERFACE V22.9 (FINAL)
    - Imagem Padrão: 135908570815238
    - Carregamento Automático de Módulos (Core + Img Finder)
    - Criador: Hatsune_inkyt
]]

local THEME_COLOR = Color3.fromRGB(0, 210, 255)
local DEFAULT_ID = "rbxassetid://135908570815238"

-- 1. Função de Notificação
local function Notify(title, text)
    pcall(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = title,
            Text = text,
            Icon = getgenv().FlowImageData or DEFAULT_ID,
            Duration = 3
        })
    end)
end

-----------------------------------------------------------
-- CHAMADA DOS LOADSTRINGS (Módulos Externos)
-----------------------------------------------------------
local function LoadExternalModules()
    -- Carrega o Localizador de Imagem (e por consequência a lista.im)
    task.spawn(function()
        local success, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/inkzinho-fofin/Inkzin_hub/refs/heads/main/Img_finder"))()
        end)
        if not success then warn("Erro ao carregar Img_finder: ", err) end
    end)

    -- Carrega o Core de Funções
    task.spawn(function()
        local success, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/inkzinho-fofin/Inkzin_hub/refs/heads/main/Flow_fruit_core"))()
        end)
        if not success then warn("Erro ao carregar Flow_fruit_core: ", err) end
    end)
end

LoadExternalModules()

-----------------------------------------------------------
-- CONSTRUÇÃO DA INTERFACE
-----------------------------------------------------------
local sg = Instance.new("ScreenGui", game:GetService("CoreGui"))
sg.Name = "FlowFinder_V22_9"

-- Botão Toggle (Abre/Fecha)
local ToggleBtn = Instance.new("ImageButton", sg)
ToggleBtn.Size = UDim2.new(0, 55, 0, 55)
ToggleBtn.Position = UDim2.new(0, 15, 0, 15)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
ToggleBtn.Image = DEFAULT_ID -- Começa com a imagem padrão
Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(1, 0)
Instance.new("UIStroke", ToggleBtn).Color = THEME_COLOR

-- Janela Principal
local MainFrame = Instance.new("Frame", sg)
MainFrame.Size = UDim2.new(0, 320, 0, 190)
MainFrame.Position = UDim2.new(0.5, -160, 0.4, -95)
MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
MainFrame.ClipsDescendants = true
Instance.new("UICorner", MainFrame)
Instance.new("UIStroke", MainFrame).Color = THEME_COLOR

-- Imagem de Fundo Dinâmica
local BgImg = Instance.new("ImageLabel", MainFrame)
BgImg.Name = "Background"
BgImg.Size = UDim2.new(1, 0, 1, 0)
BgImg.BackgroundTransparency = 1
BgImg.ImageTransparency = 0.85
BgImg.ZIndex = 1
BgImg.Image = DEFAULT_ID -- Já inicia com a sua imagem padrão

-- Header e Status
local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1, 0, 0, 35)
Title.Text = "FLOW FRUIT FINDER"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.BackgroundTransparency = 1
Title.ZIndex = 3

local StatusLabel = Instance.new("TextLabel", MainFrame)
StatusLabel.Size = UDim2.new(1, -30, 0, 70)
StatusLabel.Position = UDim2.new(0, 15, 0.5, 0)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "CARREGANDO SISTEMA..."
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.Font = Enum.Font.GothamMedium
StatusLabel.TextSize = 14
StatusLabel.TextWrapped = true
StatusLabel.ZIndex = 3

-----------------------------------------------------------
-- LÓGICA DE ATUALIZAÇÃO E OPERAÇÃO
-----------------------------------------------------------

-- Monitora a troca de imagem via getgenv
task.spawn(function()
    while task.wait(0.5) do
        if getgenv().FlowImageData and BgImg.Image ~= getgenv().FlowImageData then
            BgImg.Image = getgenv().FlowImageData
            ToggleBtn.Image = getgenv().FlowImageData
        end
    end
end)

-- Loop de funcionamento (Core + Scan)
task.spawn(function()
    -- Espera o Core carregar
    while not getgenv().FlowCore do task.wait(1) end
    local Core = getgenv().FlowCore
    
    Notify("CONECTADO", "Sistema Flow carregado com sucesso!")

    while true do
        StatusLabel.Text = "VARRENDO SERVIDOR..."
        local fruits = Core.Scan()
        
        if fruits and #fruits > 0 then
            for _, f in ipairs(fruits) do
                Notify("ITEM ENCONTRADO", "Coletando: " .. f.Name:upper())
                Core.SmartMove(f:GetPivot(), function(msg)
                    StatusLabel.Text = msg:upper()
                end)
                Core.Store(f)
                task.wait(1)
            end
        else
            StatusLabel.Text = "NADA ENCONTRADO.\nTROCANDO DE SERVIDOR..."
            task.wait(5)
            Core.Hop() -- Chama a troca de servidor do Core
        end
        task.wait(1)
    end
end)

-- Toggle Menu
ToggleBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)
