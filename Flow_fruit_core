--[[
    Repository: Flow Fruit Finder Library
    Type: ModuleScript
    Author: Hatsune_inkyt (Logic Structure)
]]

local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")

local Library = {}

-- === CONFIGURAÇÃO E LISTA DE FRUTAS ===
Library.FruitList = {
    "Rocket Fruit", "Spin Fruit", "Chop Fruit", "Spring Fruit", 
    "Bomb Fruit", "Smoke Fruit", "Spike Fruit", "Flame Fruit", 
    "Falcon Fruit", "Ice Fruit", "Sand Fruit", "Dark Fruit", 
    "Revive Fruit", "Diamond Fruit", "Light Fruit", "Love Fruit", 
    "Rubber Fruit", "Barrier Fruit", "Magma Fruit", "Quake Fruit", 
    "Buddha Fruit", "Spider Fruit", "Phoenix Fruit", "Portal Fruit", 
    "Rumble Fruit", "Paw Fruit", "Blizzard Fruit", "Gravity Fruit", 
    "Mammoth Fruit", "T-Rex Fruit", "Dough Fruit", "Shadow Fruit", 
    "Venom Fruit", "Control Fruit", "Spirit Fruit", "Leopard Fruit", 
    "Kitsune Fruit", 
    -- As duas Dragons solicitadas
    "Dragon Fruit (V1)", "Dragon Fruit (Rework/V2)" 
}

-- === SERVIÇOS INTERNOS ===

Library.Services = {
    Tween = {},
    Teleport = {},
    Hop = {},
    Esp = {},
    BarSystem = {}, -- BarSistemService
    Check = {},
    Count = {}
}

-- [CountService]
function Library.Services.Count:GetFruitCount()
    local count = 0
    local foundFruits = {}
    
    for _, item in pairs(workspace:GetChildren()) do
        if table.find(Library.FruitList, item.Name) or item:FindFirstChild("Fruit") then 
            -- Ajuste a detecção conforme o nome exato do objeto no jogo
            count = count + 1
            table.insert(foundFruits, item)
        end
    end
    return count, foundFruits
end

-- [TweenService] (Movimentação suave para curtas distâncias)
function Library.Services.Tween:MoveTo(targetCFrame, speed)
    local Character = Players.LocalPlayer.Character
    if not Character or not Character:FindFirstChild("HumanoidRootPart") then return end
    
    local Root = Character.HumanoidRootPart
    local Distance = (Root.Position - targetCFrame.Position).Magnitude
    local Time = Distance / speed -- Tempo = Distancia / Velocidade
    
    local TweenInfoObj = TweenInfo.new(Time, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
    local Tween = TweenService:Create(Root, TweenInfoObj, {CFrame = targetCFrame})
    Tween:Play()
    
    -- Retorna o tempo para aguardar
    return Time
end

-- [TeleportService] (Movimentação instantânea para longas distâncias)
function Library.Services.Teleport:BypassTP(targetCFrame)
    local Character = Players.LocalPlayer.Character
    if Character and Character:FindFirstChild("HumanoidRootPart") then
        Character.HumanoidRootPart.CFrame = targetCFrame
    end
end

-- [EspService]
function Library.Services.Esp:Create(instance, name, color)
    if instance:FindFirstChild("FlowESP") then return end
    
    local Billboard = Instance.new("BillboardGui")
    Billboard.Name = "FlowESP"
    Billboard.Adornee = instance
    Billboard.Size = UDim2.new(0, 200, 0, 50)
    Billboard.AlwaysOnTop = true
    
    local Label = Instance.new("TextLabel")
    Label.Parent = Billboard
    Label.Size = UDim2.new(1, 0, 1, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name .. " [" .. math.floor((Players.LocalPlayer.Character.HumanoidRootPart.Position - instance.Position).Magnitude) .. "m]"
    Label.TextColor3 = color or Color3.fromRGB(255, 0, 0)
    Label.TextStrokeTransparency = 0
    
    Billboard.Parent = instance
end

-- [HopService] (Lógica de troca de servidor)
function Library.Services.Hop:ServerHop()
    -- Exemplo básico de Hop. Em execução real, você precisaria iterar sobre a lista de servidores via API.
    Library:Notify("Sistema", "Procurando novo servidor (Hop)...", 3)
    
    local PlaceId = game.PlaceId
    -- Lógica simplificada para evitar crash neste exemplo educacional:
    -- TeleportService:Teleport(PlaceId, Players.LocalPlayer) 
    print("Hop Service Triggered") 
end

-- [Check Service]
function Library.Services.Check:IsSafe()
    -- Verifica saúde ou ameaças próximas
    local Char = Players.LocalPlayer.Character
    if Char and Char:FindFirstChild("Humanoid") and Char.Humanoid.Health > 0 then
        return true
    end
    return false
end

-- [BarSistemService] (Gerenciamento visual)
function Library.Services.BarSystem:UpdateStatus(statusText)
    -- Esta função será conectada à UI no script principal
    return statusText
end

-- Utilitário de Notificação
function Library:Notify(title, text, duration)
    StarterGui:SetCore("SendNotification", {
        Title = title;
        Text = text;
        Duration = duration or 5;
    })
end

return Library
