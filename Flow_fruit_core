-- flow_fruit_finder.core
local core = {}

local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

core.Speed = 350
core.FruitList = {
    "Rocket", "Spin", "Blade", "Spring", "Bomb", "Smoke", "Spike", "Flame", "Falcon", "Ice", 
    "Sand", "Dark", "Diamond", "Light", "Rubber", "Barrier", "Ghost", "Magma", "Quake", 
    "Buddha", "Love", "Spider", "Sound", "Phoenix", "Portal", "Rumble", "Pain", "Blizzard", 
    "Gravity", "Mammoth", "T-Rex", "Dough", "Shadow", "Venom", "Control", "Spirit", "Leopard", 
    "Kitsune", "Dragon (Old)", "Dragon (East)"
}

function core.HopServer()
    local x = {}
    for _, v in ipairs(game:GetService("HttpService"):JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100")).data) do
        if v.playing < v.maxPlayers and v.id ~= game.JobId then
            x[#x + 1] = v.id
        end
    end
    if #x > 0 then
        TeleportService:TeleportToPlaceInstance(game.PlaceId, x[math.random(1, #x)])
    end
end

function core.TweenCollect(targetCFrame)
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local dist = (char.HumanoidRootPart.Position - targetCFrame.p).Magnitude
        local info = TweenInfo.new(dist / core.Speed, Enum.EasingStyle.Linear)
        local tween = TweenService:Create(char.HumanoidRootPart, info, {CFrame = targetCFrame})
        tween:Play()
        return tween
    end
end

function core.SmartTeleport(fruitHandle)
    local attempts = 0
    local success = false
    
    while attempts < 3 and not success do
        LocalPlayer.Character.HumanoidRootPart.CFrame = fruitHandle.CFrame
        task.wait(0.5)
        if (LocalPlayer.Character.HumanoidRootPart.Position - fruitHandle.Position).Magnitude < 10 then
            success = true
        else
            attempts = attempts + 1
        end
    end

    if not success then
        -- Teleporta perto e usa Tween
        LocalPlayer.Character.HumanoidRootPart.CFrame = fruitHandle.CFrame * CFrame.new(0, 10, 0)
        local tw = core.TweenCollect(fruitHandle.CFrame)
        tw.Completed:Wait()
    end
    
    -- Armazenar (Simulação de clique/proximidade)
    firetouchinterest(LocalPlayer.Character.HumanoidRootPart, fruitHandle, 0)
    firetouchinterest(LocalPlayer.Character.HumanoidRootPart, fruitHandle, 1)
end

return core
