-- FLOW_INTERFACE_V22.lua
local DEFAULT_IMG = "rbxassetid://135908570815238"
local UI_IMG = getgenv().CustomFruitImg or DEFAULT_IMG

-- Função de Mensagem Rápida Roblox
local function QuickMsg(title, text)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = text,
        Icon = getgenv().CustomFruitImg or DEFAULT_IMG,
        Duration = 3
    })
end

-- CARREGAR O CORE VIA LOADSTRING
QuickMsg("SISTEMA", "Carregando módulos do Core...")
task.wait(1)
-- SUBSTITUA PELO SEU LINK RAW DO CORE
loadstring(game:HttpGet("https://LINK_DO_SEU_CORE_AQUI.com/raw"))()

local Core = getgenv().FlowCore
local sg = Instance.new("ScreenGui", game:GetService("CoreGui"))

-- Design da Interface (Escura)
local MainFrame = Instance.new("Frame", sg)
MainFrame.Size = UDim2.new(0, 320, 0, 190)
MainFrame.Position = UDim2.new(0.5, -160, 0.4, -95)
MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Instance.new("UICorner", MainFrame)

local BgImg = Instance.new("ImageLabel", MainFrame)
BgImg.Size = UDim2.new(1, 0, 1, 0)
BgImg.Image = UI_IMG
BgImg.ImageTransparency = 0.85 -- Bem escuro para leitura
BgImg.BackgroundTransparency = 1
BgImg.ZIndex = 1

local StatusLabel = Instance.new("TextLabel", MainFrame)
StatusLabel.Size = UDim2.new(1, 0, 1, 0)
StatusLabel.BackgroundTransparency = 1
StatusLabel.TextColor3 = Color3.new(1, 1, 1)
StatusLabel.Text = "AGUARDANDO..."
StatusLabel.Font = Enum.Font.GothamBold
StatusLabel.TextSize = 14
StatusLabel.ZIndex = 2

-- Botão Toggle
local Toggle = Instance.new("ImageButton", sg)
Toggle.Size = UDim2.new(0, 50, 0, 50)
Toggle.Position = UDim2.new(0, 15, 0, 15)
Toggle.Image = UI_IMG
Toggle.BackgroundColor3 = Color3.new(0,0,0)
Instance.new("UICorner", Toggle).CornerRadius = UDim.new(1, 0)
Toggle.MouseButton1Click:Connect(function() MainFrame.Visible = not MainFrame.Visible end)

-- Loop de Monitoramento de Imagem
task.spawn(function()
    while task.wait(1) do
        local current = getgenv().CustomFruitImg or DEFAULT_IMG
        if Toggle.Image ~= current then
            Toggle.Image = current
            BgImg.Image = current
        end
    end
end)

-- LOOP DE EXECUÇÃO E ACOMPANHAMENTO
task.spawn(function()
    while true do
        StatusLabel.Text = "VARRENDO MUNDO..."
        local fruits = Core.Scan()
        
        if #fruits > 0 then
            for _, f in ipairs(fruits) do
                local fruitName = f.Name:upper()
                QuickMsg("FRUTA ENCONTRADA", "Localizada: " .. fruitName)
                
                Core.SmartMove(f:GetPivot(), function(msg, isCritical)
                    StatusLabel.Text = msg
                    if isCritical then QuickMsg("MOVIMENTAÇÃO", msg) end
                end)
                
                -- Coleta e Armazenamento
                StatusLabel.Text = "COLETANDO..."
                task.wait(0.5)
                pcall(function()
                    game:GetService("ReplicatedStorage"):FindFirstChild("CommF_", true):InvokeServer("StoreFruit", f.Name, f)
                end)
                QuickMsg("SUCESSO", fruitName .. " armazenada!")
                task.wait(1)
            end
        else
            StatusLabel.Text = "NENHUMA FRUTA. TROCANDO..."
            QuickMsg("AVISO", "Servidor vazio. Trocando em 3s...")
            task.wait(3)
            -- Lógica de Server Hop
        end
    end
end)
