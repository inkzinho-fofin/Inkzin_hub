local Lighting = game:GetService("Lighting")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local Settings = settings()

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- === CONFIGURA√á√ïES INICIAIS === --

-- Cria ou busca o efeito de corre√ß√£o de cor
local colorCorrection = Lighting:FindFirstChild("WDayCorrection") or Instance.new("ColorCorrectionEffect", Lighting)
colorCorrection.Name = "WDayCorrection"
colorCorrection.Saturation = 0

-- Valores padr√µes para o Reset (.rs)
local DEFAULT_FOG_START = Lighting.FogStart
local DEFAULT_FOG_END = Lighting.FogEnd
local DEFAULT_BRIGHTNESS = Lighting.Brightness
local DEFAULT_CLOCK = Lighting.ClockTime
local DEFAULT_AMBIENT = Lighting.Ambient
local DEFAULT_OUTDOOR = Lighting.OutdoorAmbient

-- Vari√°veis de controle
local rfogActive = false

-- === FUN√á√ïES AUXILIARES === --

-- Envia mensagem apenas para o jogador no chat (CLIENTE)
local function chatMessage(text, color)
	pcall(function()
		StarterGui:SetCore("ChatMakeSystemMessage", {
			Text = text;
			Color = color or Color3.fromRGB(0, 255, 255); -- Ciano padr√£o
			Font = Enum.Font.SourceSansBold;
			FontSize = Enum.FontSize.Size24;
		})
	end)
end

-- Sistema avan√ßado de busca de jogadores
local function getTargets(arg)
	local targets = {}
	if not arg then return targets end
	arg = arg:lower()
	local allPlayers = Players:GetPlayers()

	if arg == "@e" or arg == "all" then
		return allPlayers
	elseif arg == "@r" then
		table.insert(targets, allPlayers[math.random(1, #allPlayers)])
	elseif arg == "@p" then
		local closest = nil
		local dist = math.huge
		for _, p in pairs(allPlayers) do
			if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
				local d = (p.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
				if d < dist then
					dist = d
					closest = p
				end
			end
		end
		if closest then table.insert(targets, closest) end
	else
		-- Busca por nome parcial
		for _, p in pairs(allPlayers) do
			if p.Name:lower():sub(1, #arg) == arg or p.DisplayName:lower():sub(1, #arg) == arg then
				table.insert(targets, p)
			end
		end
	end
	return targets
end

-- === LOOP PRINCIPAL (+Rfog) === --
RunService.RenderStepped:Connect(function()
	if rfogActive then
		Lighting.FogStart = 100000
		Lighting.FogEnd = 100000
		Lighting.Brightness = 2
		Lighting.ClockTime = 14
		Lighting.GlobalShadows = false
	end
end)

-- === PROCESSAMENTO DE COMANDOS === --

player.Chatted:Connect(function(msg)
	-- Separa o comando dos argumentos
	local args = msg:split(" ")
	local cmd = args[1]:lower()
	
	-- 1. HELP / AJUDA (.?)
	if cmd == ".?" then
		chatMessage("=== LISTA DE COMANDOS ===", Color3.fromRGB(255, 215, 0))
		chatMessage("+Foc <1-100> : Controla neblina (1=Lento/Perto, 100=R√°pido/Longe)", Color3.white)
		chatMessage("/Wday <baixa/media/alta> : Satura√ß√£o da tela", Color3.white)
		chatMessage("+Rfog : Remove neblina e trava luz (Toggle)", Color3.white)
		chatMessage("+Explode <nome/@p/@e/@r> : Explode alvo", Color3.white)
		chatMessage("*Kick <nome> : Kicka o jogador", Color3.white)
		chatMessage(".rs : Reinicia o script e luzes", Color3.fromRGB(255, 100, 100))
	
	-- 2. RESET (.rs)
	elseif cmd == ".rs" then
		rfogActive = false
		colorCorrection.Saturation = 0
		
		-- Retorna ilumina√ß√£o ao original suavemente
		local tweenInfo = TweenInfo.new(1.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		TweenService:Create(Lighting, tweenInfo, {
			FogStart = DEFAULT_FOG_START,
			FogEnd = DEFAULT_FOG_END,
			Brightness = DEFAULT_BRIGHTNESS,
			ClockTime = DEFAULT_CLOCK,
			Ambient = DEFAULT_AMBIENT,
			OutdoorAmbient = DEFAULT_OUTDOOR
		}):Play()
		
		chatMessage("[SYSTEM] Script reiniciado com sucesso.", Color3.fromRGB(0, 255, 0))

	-- 3. REMOVE FOG (+Rfog)
	elseif cmd == "+rfog" then
		rfogActive = not rfogActive
		if rfogActive then
			chatMessage("‚ö° Neblina Removida (Travada)", Color3.fromRGB(255, 255, 0))
		else
			chatMessage("‚òÅÔ∏è Neblina Destravada", Color3.fromRGB(200, 200, 200))
			Lighting.GlobalShadows = true
		end

	-- 4. FOG CONTROL (+Foc)
	elseif cmd == "+foc" then
		local val = tonumber(args[2])
		if val then
			rfogActive = false -- Desativa o Rfog para permitir a mudan√ßa
			val = math.clamp(val, 1, 100)
			
			-- L√≥gica: 
			-- Velocidade: 1 √© lento (ex: 5s), 100 √© r√°pido (ex: 0.5s)
			-- Dist√¢ncia: 1 √© perto (neblina densa), 100 √© longe (vis√£o limpa)
			
			local speedTime = 5 - ((val / 100) * 4.5) -- Mapeia de 5s at√© 0.5s
			local targetDist = val * 50 -- Ex: 1 = 50 studs, 100 = 5000 studs
			
			local info = TweenInfo.new(speedTime, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut)
			TweenService:Create(Lighting, info, {FogEnd = targetDist, FogStart = 0}):Play()
			
			chatMessage("Fog ajustado: " .. val .. "% (Dist: " .. targetDist .. " | Tempo: " .. string.format("%.1f", speedTime) .. "s)")
		end

	-- 5. SATURATION (/Wday)
	elseif cmd == "/wday" then
		local mode = args[2] and args[2]:lower() or ""
		
		if mode == "baixa" or mode == "baixo" then
			TweenService:Create(colorCorrection, TweenInfo.new(1), {Saturation = -1}):Play()
			chatMessage("Satura√ß√£o: Baixa (P&B)")
			
		elseif mode == "media" or mode == "medio" or mode == "padr√£o" or mode == "padrao" then
			TweenService:Create(colorCorrection, TweenInfo.new(1), {Saturation = 0}):Play()
			chatMessage("Satura√ß√£o: M√©dia (Padr√£o)")
			
		elseif mode == "alta" or mode == "alto" then
			TweenService:Create(colorCorrection, TweenInfo.new(1), {Saturation = 0.8}):Play()
			chatMessage("Satura√ß√£o: Alta (V√≠vido)")
		else
			chatMessage("Uso: /Wday <baixa, media, alta>", Color3.fromRGB(255, 100, 100))
		end

	-- 6. EXPLODE (+Explode)
	elseif cmd == "+explode" then
		local targets = getTargets(args[2])
		if #targets > 0 then
			for _, target in pairs(targets) do
				if target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
					local exp = Instance.new("Explosion")
					exp.Position = target.Character.HumanoidRootPart.Position
					exp.BlastRadius = 10
					exp.BlastPressure = 500000
					exp.Parent = workspace
					chatMessage("üí• BOOM: " .. target.Name, Color3.fromRGB(255, 50, 50))
				end
			end
		else
			chatMessage("Nenhum alvo encontrado para explos√£o.", Color3.fromRGB(255, 100, 100))
		end

	-- 7. KICK (*Kick)
	elseif cmd == "*kick" then
		local targetName = args[2]
		local targetList = getTargets(targetName)
		
		-- Mensagem personalizada
		local kickMsg = "Voc√™ foi expulso do servidor por " .. player.Name .. ". Voc√™ n√£o pode retornar a este servidor."
		
		if #targetList > 0 then
			for _, t in pairs(targetList) do
				-- Tentativa de Kick (Nota: Em LocalScript s√≥ funciona em si mesmo, a menos que seja SS)
				pcall(function()
					t:Kick(kickMsg)
				end)
				chatMessage("Tentando expulsar: " .. t.Name, Color3.fromRGB(255, 0, 0))
			end
		else
			chatMessage("Jogador n√£o encontrado para Kick.", Color3.fromRGB(255, 100, 100))
		end
	end
end)

-- Mensagem de inicializa√ß√£o
chatMessage("Script Carregado! Digite .? para ver os comandos.", Color3.fromRGB(100, 255, 100))
