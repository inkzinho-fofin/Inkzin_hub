--[[
    FLOW-BLOX LIBRARY v3.0 (COMPLETA - 2026)
    O ecossistema definitivo para Luau no Roblox.
]]

local FlowBlox = {}
FlowBlox.__index = FlowBlox

-- [ 1. KERNEL: CARREGAMENTO DINÂMICO DE SERVIÇOS ]
-- Permite acesso como: FlowBlox.RunService ou FlowBlox.HttpService
setmetatable(FlowBlox, {
    __index = function(_, key)
        local success, service = pcall(function() return game:GetService(key) end)
        if success then
            FlowBlox[key] = service
            return service
        end
        return nil
    end
})

-- [ 2. INSTANCE FACTORY (Criação de Objetos) ]
FlowBlox.Creator = {
    New = function(className, properties, parent)
        local obj = Instance.new(className)
        for prop, val in pairs(properties or {}) do
            obj[prop] = val
        end
        if parent then obj.Parent = parent end
        return obj
    end,
    
    Clone = function(obj, properties, parent)
        local newObj = obj:Clone()
        for prop, val in pairs(properties or {}) do
            newObj[prop] = val
        end
        if parent then newObj.Parent = parent end
        return newObj
    end
}

-- [ 3. PLAYER & CHARACTER (Gestão de Jogadores) ]
FlowBlox.Users = {
    LocalPlayer = game:GetService("Players").LocalPlayer,
    
    GetCharacter = function(player)
        player = player or game:GetService("Players").LocalPlayer
        return player.Character or player.CharacterAdded:Wait()
    end,
    
    Notify = function(title, text, duration, icon)
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = title or "Flow-Blox",
            Text = text or "",
            Duration = duration or 5,
            Icon = icon or ""
        })
    end,
    
    EquipTool = function(tool, player)
        local char = FlowBlox.Users.GetCharacter(player)
        tool.Parent = char
    end
}

-- [ 4. TWEEN ENGINE (Animações Modernas) ]
FlowBlox.Animate = function(object, duration, properties, style, direction)
    local tweenInfo = TweenInfo.new(
        duration or 1,
        style or Enum.EasingStyle.Quad,
        direction or Enum.EasingDirection.Out
    )
    local tween = game:GetService("TweenService"):Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

-- [ 5. DATA MANAGEMENT (Persistência) ]
FlowBlox.Data = {
    Save = function(storeName, key, value)
        local ds = game:GetService("DataStoreService"):GetDataStore(storeName)
        local success, err = pcall(function() return ds:SetAsync(key, value) end)
        return success, err
    end,
    
    Fetch = function(storeName, key)
        local ds = game:GetService("DataStoreService"):GetDataStore(storeName)
        local success, data = pcall(function() return ds:GetAsync(key) end)
        return data, success
    end
}

-- [ 6. RAYCASTING & SPATIAL (Física) ]
FlowBlox.Spatial = {
    QuickCast = function(origin, direction, ignoreList)
        local params = RaycastParams.new()
        params.FilterType = Enum.RaycastFilterType.Exclude
        params.FilterDescendantsInstances = ignoreList or {}
        return workspace:Raycast(origin, direction, params)
    end,
    
    GetDistance = function(pos1, pos2)
        return (pos1 - pos2).Magnitude
    end
}

-- [ 7. NETWORK (Remotes Facilitados) ]
FlowBlox.Net = {
    FireServer = function(name, ...)
        local remote = game:GetService("ReplicatedStorage"):FindFirstChild(name)
        if remote and remote:IsA("RemoteEvent") then
            remote:FireServer(...)
        end
    end,
    
    OnClientEvent = function(name, callback)
        local remote = game:GetService("ReplicatedStorage"):WaitForChild(name)
        return remote.OnClientEvent:Connect(callback)
    end
}

-- [ 8. TASK SCHEDULER (Gestão de Tempo 2026) ]
FlowBlox.Schedule = {
    Wait = task.wait,
    Defer = task.defer,
    Delay = task.delay,
    Spawn = task.spawn,
    
    Every = function(seconds, callback)
        return task.spawn(function()
            while true do
                callback()
                task.wait(seconds)
            end
        end)
    end
}

-- [ 9. UI HELPERS ]
FlowBlox.UI = {
    CreateScreen = function(name)
        return FlowBlox.Creator.New("ScreenGui", {Name = name, ResetOnSpawn = false}, 
            FlowBlox.Users.LocalPlayer:WaitForChild("PlayerGui"))
    end,
    
    FadeIn = function(guiObject, duration)
        guiObject.Visible = true
        return FlowBlox.Animate(guiObject, duration, {GroupTransparency = 0})
    end
}

return FlowBlox
