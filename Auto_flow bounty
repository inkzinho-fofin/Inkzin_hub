local Library = {}

-- Serviços
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- // MÓDULO DE MOVIMENTAÇÃO (TWEENS)
Library.Movement = {
    Tween = function(instance, targetCFrame, speed)
        if not instance or not targetCFrame then return end
        local root = instance:IsA("BasePart") and instance or instance:FindFirstChild("HumanoidRootPart")
        if not root then return end

        local distance = (root.Position - targetCFrame.Position).Magnitude
        local duration = distance / speed
        
        local tween = TweenService:Create(root, TweenInfo.new(duration, Enum.EasingStyle.Linear), {CFrame = targetCFrame})
        tween:Play()
        return tween
    end,
    
    StopTweens = function(instance)
        -- Cancela tweens ativos no objeto para evitar conflitos
        local root = instance:FindFirstChild("HumanoidRootPart") or instance
        TweenService:Create(root, TweenInfo.new(0), {CFrame = root.CFrame}):Play()
    end
}

-- // MÓDULO DE SEGURANÇA (SAFE-CHECK)
Library.Safety = {
    IsLowHealth = function(humanoid, percentage)
        if not humanoid then return false end
        return humanoid.Health < (humanoid.MaxHealth * percentage)
    end,
    
    GetSafePoint = function(currentPos)
        -- Retorna uma posição alta no céu baseada na posição atual
        return CFrame.new(currentPos.X, currentPos.Y + 500, currentPos.Z)
    end
}

-- // MÓDULO DE COMBATE
Library.Combat = {
    GetNearestTarget = function(maxDistance, priorityType)
        local target = nil
        local minVal = math.huge
        
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Humanoid") then
                local char = p.Character
                local dist = (LocalPlayer.Character.HumanoidRootPart.Position - char.HumanoidRootPart.Position).Magnitude
                
                if dist <= maxDistance and char.Humanoid.Health > 0 then
                    if priorityType == "Distance" then
                        if dist < minVal then minVal = dist; target = p end
                    else -- Low Health
                        if char.Humanoid.Health < minVal then minVal = char.Humanoid.Health; target = p end
                    end
                end
            end
        end
        return target
    end
}

return Library
