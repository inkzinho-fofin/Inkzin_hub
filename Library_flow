--[[
    FLOW-BLOX LIBRARY v3.0 (ULTIMATE EDITION - 2026)
    O ecossistema definitivo para Luau no Roblox.
    Desenvolvido para: flow-blox kaitun | Hatsune_inkyt
]]

local FlowBlox = {}
FlowBlox.__index = FlowBlox

-- [ 1. KERNEL & SERVICES ]
setmetatable(FlowBlox, {
    __index = function(_, key)
        local success, service = pcall(function() return game:GetService(key) end)
        if success then FlowBlox[key] = service return service end
        return nil
    end
})

-- [ 2. INSTANCE FACTORY ]
FlowBlox.Creator = {
    New = function(className, properties, parent)
        local obj = Instance.new(className)
        for prop, val in pairs(properties or {}) do obj[prop] = val end
        if parent then obj.Parent = parent end
        return obj
    end
}

-- [ 3. PLAYER & CHARACTER ]
FlowBlox.Users = {
    LocalPlayer = game.Players.LocalPlayer,
    GetCharacter = function()
        return game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
    end,
    EquipTool = function(toolName)
        local bp = game.Players.LocalPlayer.Backpack:FindFirstChild(toolName)
        if bp then bp.Parent = FlowBlox.Users.GetCharacter() end
    end
}

-- [ 4. PROGRESSION ENGINE (O CÉREBRO DO KAITUN) ]
FlowBlox.Progression = {
    -- Tabela de dados de nível (Exemplo simplificado Sea 1)
    LevelData = {
        {MinLvl = 0, MaxLvl = 15, Enemy = "Bandit", Quest = "BanditQuest1", Pos = Vector3.new(1059, 15, 1545)},
        {MinLvl = 15, MaxLvl = 30, Enemy = "Monkey", Quest = "JungleQuest", Pos = Vector3.new(-1610, 36, 150)},
        {MinLvl = 30, MaxLvl = 60, Enemy = "Gorilla", Quest = "GorillaQuest", Pos = Vector3.new(-1210, 28, -230)},
        -- Adicione aqui até o 2800 seguindo o padrão
    },

    GetTask = function()
        local currentLvl = game.Players.LocalPlayer.Data.Level.Value
        for _, data in ipairs(FlowBlox.Progression.LevelData) do
            if currentLvl >= data.MinLvl and currentLvl < data.MaxLvl then
                return data
            end
        end
        return FlowBlox.Progression.LevelData[#FlowBlox.Progression.LevelData]
    end,

    GetCurrentSea = function()
        local placeId = game.PlaceId
        if placeId == 2753915549 then return 1
        elseif placeId == 4442272183 then return 2
        elseif placeId == 7449925069 then return 3
        end
        return 1
    end
}

-- [ 5. TWEEN ENGINE ]
FlowBlox.Animate = function(object, duration, properties)
    local tweenInfo = TweenInfo.new(duration or 1, Enum.EasingStyle.Linear)
    local tween = game:GetService("TweenService"):Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

-- [ 6. SPATIAL & PHYSICS ]
FlowBlox.Spatial = {
    GetDistance = function(pos1, pos2)
        return (pos1 - pos2).Magnitude
    end,
    
    SafeTween = function(targetPos)
        local char = FlowBlox.Users.GetCharacter()
        local root = char:WaitForChild("HumanoidRootPart")
        local dist = FlowBlox.Spatial.GetDistance(root.Position, targetPos)
        local speed = 300 -- Velocidade do Tween (ajustável)
        local duration = dist / speed
        
        return FlowBlox.Animate(root, duration, {CFrame = CFrame.new(targetPos)})
    end
}

-- [ 7. NETWORK ]
FlowBlox.Net = {
    FireServer = function(...)
        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(...)
    end
}

-- [ 8. TASK SCHEDULER ]
FlowBlox.Schedule = {
    Wait = task.wait,
    Spawn = task.spawn,
    Every = function(seconds, callback)
        return task.spawn(function()
            while true do
                callback()
                task.wait(seconds)
            end
        end)
    end
}

-- [ 9. UI HELPERS ]
FlowBlox.UI = {
    CreateScreen = function(name)
        return FlowBlox.Creator.New("ScreenGui", {Name = name, ResetOnSpawn = false}, 
            game.Players.LocalPlayer:WaitForChild("PlayerGui"))
    end
}

return FlowBlox
