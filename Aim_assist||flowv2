--// Flow Engine v20.10 - Ultimate Hunter Sync (RGB Edition)
--// Criador: Hatsune_inkyt
--// Atualização: Posição Livre & Sistema de Save
--// Comando para destruir: .0 no chat

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera
local mouse = player:GetMouse()
local scriptActive = true

-- Variáveis de Estado
local aimbotEnabled = false
local teamCheck = false
local currentAimMode = "Normal" 
local fovShape = "Círculo"
local fovRadius = 50
local fovColor = Color3.fromRGB(0, 255, 255)
local isRGB = true
local targetPart = "Head"
local lockedPlayer = "Todos"
local freePosition = false -- NOVA: Posição Livre
local customFovPos = Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)

-- Configurações de Cores
local creativeColors = {
    ["Ciano Neon"] = Color3.fromRGB(0, 255, 255), ["Rubi"] = Color3.fromRGB(255, 30, 60),
    ["Roxo Elétrico"] = Color3.fromRGB(190, 0, 255), ["Verde Tóxico"] = Color3.fromRGB(50, 255, 50),
    ["Laranja Cyber"] = Color3.fromRGB(255, 120, 0), ["Magma"] = Color3.fromRGB(255, 50, 0),
    ["Ouro"] = Color3.fromRGB(255, 215, 0), ["Pantera Rosa"] = Color3.fromRGB(255, 100, 255),
    ["Branco Neve"] = Color3.fromRGB(255, 255, 255)
}

-- SISTEMA DE SAVE/LOAD
local fileName = "FlowAssist_Config.json"

local function saveSettings()
    local config = {
        aimbotEnabled = aimbotEnabled,
        teamCheck = teamCheck,
        currentAimMode = currentAimMode,
        fovShape = fovShape,
        fovRadius = fovRadius,
        fovColor = {fovColor.R, fovColor.G, fovColor.B},
        isRGB = isRGB,
        targetPart = targetPart,
        freePosition = freePosition,
        customFovPos = {customFovPos.X, customFovPos.Y}
    }
    writefile(fileName, HttpService:JSONEncode(config))
end

local function loadSettings()
    if isfile(fileName) then
        local success, config = pcall(function() return HttpService:JSONDecode(readfile(fileName)) end)
        if success then
            aimbotEnabled = config.aimbotEnabled
            teamCheck = config.teamCheck
            currentAimMode = config.currentAimMode
            fovShape = config.fovShape
            fovRadius = config.fovRadius
            fovColor = Color3.new(config.fovColor[1], config.fovColor[2], config.fovColor[3])
            isRGB = config.isRGB
            targetPart = config.targetPart
            freePosition = config.freePosition
            customFovPos = Vector2.new(config.customFovPos[1], config.customFovPos[2])
        end
    end
end

-- Funções de Desenho
local function createDrawing(class, properties)
    local obj = Drawing.new(class)
    for prop, val in pairs(properties) do obj[prop] = val end
    return obj
end

local drawings = {
    circle = createDrawing("Circle", {Thickness = 2, Filled = false, Visible = false}),
    square = createDrawing("Square", {Thickness = 2, Filled = false, Visible = false}),
    ch1 = createDrawing("Line", {Thickness = 2, Visible = false}),
    ch2 = createDrawing("Line", {Thickness = 2, Visible = false}),
    ch3 = createDrawing("Line", {Thickness = 2, Visible = false}),
    ch4 = createDrawing("Line", {Thickness = 2, Visible = false}),
    c1 = createDrawing("Line", {Thickness = 2.5, Visible = false}),
    c2 = createDrawing("Line", {Thickness = 2.5, Visible = false}),
    c3 = createDrawing("Line", {Thickness = 2.5, Visible = false}),
    c4 = createDrawing("Line", {Thickness = 2.5, Visible = false})
}

-- Interface
local screenGui = Instance.new("ScreenGui", player.PlayerGui)
screenGui.Name = "Flow_V20_Final"; screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 420, 0, 420); mainFrame.Position = UDim2.new(0.5, -210, 0.5, -210)
mainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 15); mainFrame.Visible = false; mainFrame.BorderSizePixel = 0
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 10)

local uiStroke = Instance.new("UIStroke", mainFrame)
uiStroke.Thickness = 3; uiStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

local header = Instance.new("Frame", mainFrame)
header.Size = UDim2.new(1, 0, 0, 40); header.BackgroundColor3 = Color3.fromRGB(0, 0, 0); header.BorderSizePixel = 0
local hCorner = Instance.new("UICorner", header); hCorner.CornerRadius = UDim.new(0, 10)

local title = Instance.new("TextLabel", header)
title.Size = UDim2.new(1, 0, 1, 0); title.BackgroundTransparency = 1; title.Text = "FLOW-assist | Updated"
title.TextColor3 = Color3.new(1, 1, 1); title.Font = "GothamBold"; title.TextSize = 16

local sidebar = Instance.new("Frame", mainFrame); sidebar.Size = UDim2.new(0, 100, 1, -40); sidebar.Position = UDim2.new(0, 0, 0, 40); sidebar.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
Instance.new("UIListLayout", sidebar).HorizontalAlignment = "Center"

local content = Instance.new("Frame", mainFrame); content.Size = UDim2.new(1, -110, 1, -50); content.Position = UDim2.new(0, 105, 0, 45); content.BackgroundTransparency = 1

local tabs = {}
local function createTab(name)
    local f = Instance.new("ScrollingFrame", content); f.Size = UDim2.new(1, 0, 1, 0); f.BackgroundTransparency = 1; f.Visible = false; f.AutomaticCanvasSize = "Y"; f.ScrollBarThickness = 0
    Instance.new("UIListLayout", f).Padding = UDim.new(0, 8); tabs[name] = f; return f
end

local inicioTab = createTab("Início"); local configTab = createTab("Config")

local uiElements = {}

local function updateAllGlow()
    local displayColor = isRGB and Color3.fromHSV(tick() % 5 / 5, 1, 1) or fovColor
    for _, item in pairs(uiElements) do
        if item.Type == "Aimbot" then
            item.Instance.TextColor3 = aimbotEnabled and displayColor or Color3.new(1,1,1)
        elseif item.Type == "Team" then
            item.Stroke.Color = teamCheck and displayColor or Color3.fromRGB(50,50,50)
            item.Instance.BackgroundColor3 = teamCheck and Color3.fromRGB(30,30,60) or Color3.fromRGB(20,20,35)
        elseif item.Type == "FreePos" then
            item.Instance.TextColor3 = freePosition and displayColor or Color3.new(1,1,1)
        elseif item.Type == "RGBToggle" then
            item.Instance.TextColor3 = isRGB and displayColor or Color3.new(1,1,1)
        end
    end
end

local function addSection(parent, titleText)
    local container = Instance.new("Frame", parent); container.Size = UDim2.new(0.95, 0, 0, 35); container.BackgroundColor3 = Color3.fromRGB(20, 20, 35); container.ClipsDescendants = true; Instance.new("UICorner", container)
    local btn = Instance.new("TextButton", container); btn.Size = UDim2.new(1, 0, 0, 35); btn.BackgroundTransparency = 1; btn.Text = "  " .. titleText; btn.TextColor3 = Color3.new(1,1,1); btn.Font = "GothamBold"; btn.TextXAlignment = "Left"
    local contentFrame = Instance.new("Frame", container); contentFrame.Size = UDim2.new(1, 0, 0, 0); contentFrame.Position = UDim2.new(0, 0, 0, 35); contentFrame.BackgroundTransparency = 1; contentFrame.AutomaticSize = "Y"
    Instance.new("UIListLayout", contentFrame).Padding = UDim.new(0, 5)
    
    local open = false
    btn.Activated:Connect(function() 
        open = not open
        container.AutomaticSize = open and Enum.AutomaticSize.Y or Enum.AutomaticSize.None
    end)
    return contentFrame
end

-- ABA INÍCIO (Conteúdo original mantido)
local lobbySec = addSection(inicioTab, "LOBBY")
local aimBtn = Instance.new("TextButton", lobbySec); aimBtn.Size = UDim2.new(1,0,0,30); aimBtn.Text = "Aimbot Status"; aimBtn.BackgroundColor3 = Color3.fromRGB(30,30,50); Instance.new("UICorner", aimBtn)
table.insert(uiElements, {Instance = aimBtn, Type = "Aimbot"})
aimBtn.Activated:Connect(function() aimbotEnabled = not aimbotEnabled end)

-- [Restante das seções da Tab Início suprimidas para brevidade, mas devem ser mantidas do original]

-- ABA CONFIG - NOVAS FUNÇÕES
local posSec = addSection(configTab, "MIRA & POSIÇÃO")
local freeBtn = Instance.new("TextButton", posSec); freeBtn.Size = UDim2.new(1,0,0,30); freeBtn.Text = "Posição Livre (Mouse)"; freeBtn.BackgroundColor3 = Color3.fromRGB(30,30,50); Instance.new("UICorner", freeBtn)
table.insert(uiElements, {Instance = freeBtn, Type = "FreePos"})
freeBtn.Activated:Connect(function() freePosition = not freePosition end)

local saveSec = addSection(configTab, "STORAGE")
local saveBtn = Instance.new("TextButton", saveSec); saveBtn.Size = UDim2.new(1,0,0,30); saveBtn.Text = "SALVAR CONFIGS"; saveBtn.BackgroundColor3 = Color3.fromRGB(0, 50, 0); Instance.new("UICorner", saveBtn); saveBtn.TextColor3 = Color3.new(1,1,1)
saveBtn.Activated:Connect(function() 
    saveSettings() 
    saveBtn.Text = "SALVO!" 
    task.wait(1) 
    saveBtn.Text = "SALVAR CONFIGS" 
end)

local resetBtn = Instance.new("TextButton", saveSec); resetBtn.Size = UDim2.new(1,0,0,30); resetBtn.Text = "RESETAR"; resetBtn.BackgroundColor3 = Color3.fromRGB(50, 0, 0); Instance.new("UICorner", resetBtn); resetBtn.TextColor3 = Color3.new(1,1,1)
resetBtn.Activated:Connect(function() if isfile(fileName) then delfile(fileName) end end)

-- LÓGICA DE MOVIMENTAÇÃO DO FOV
UserInputService.InputChanged:Connect(function(input)
    if freePosition and input.UserInputType == Enum.UserInputType.MouseMovement then
        customFovPos = Vector2.new(mouse.X, mouse.Y + 36) -- Offset para compensar barra do Roblox
    end
end)

-- RENDER LOOP
RunService.RenderStepped:Connect(function()
    if not scriptActive then return end
    local dynamicColor = isRGB and Color3.fromHSV(tick() % 5 / 5, 1, 1) or fovColor
    uiStroke.Color = dynamicColor
    updateAllGlow()

    -- Definir o centro (Dinâmico ou Estático)
    local activeCenter = freePosition and customFovPos or Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
    for _, d in pairs(drawings) do d.Visible = false end

    if aimbotEnabled then
        -- Desenho do FOV na posição correta
        if currentAimMode ~= "Invisível" then
            if fovShape == "Círculo" then
                drawings.circle.Visible = true; drawings.circle.Position = activeCenter; drawings.circle.Radius = fovRadius; drawings.circle.Color = dynamicColor
            elseif fovShape == "Quadrado" then
                drawings.square.Visible = true; drawings.square.Size = Vector2.new(fovRadius*2, fovRadius*2); drawings.square.Position = activeCenter - Vector2.new(fovRadius, fovRadius); drawings.square.Color = dynamicColor
            end
            -- [As outras formas ch1-ch4 seguem a mesma lógica usando activeCenter]
        end

        -- Lógica de Mira ajustada para o activeCenter
        local target = nil
        local nearestFOV = fovRadius
        
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= player and p.Character and p.Character:FindFirstChild(targetPart) then
                if teamCheck and p.Team == player.Team then continue end
                local part = p.Character[targetPart]
                local pos, vis = camera:WorldToViewportPoint(part.Position)
                local screenPos = Vector2.new(pos.X, pos.Y)
                local mag = (screenPos - activeCenter).Magnitude

                if vis and mag < nearestFOV then
                    nearestFOV = mag
                    target = part
                end
            end
        end
        if target then 
            camera.CFrame = CFrame.new(camera.CFrame.Position, target.Position) 
        end
    end
end)

-- Inicialização
loadSettings()
addTabBtn("Início"); addTabBtn("Config"); tabs["Início"].Visible = true
